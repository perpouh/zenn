---
title: "引き続きAIと協働しようとしているログ"
emoji: "🍄"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: [Cursor,ドキュメント駆動開発]
published: false
---

# 引き続きAIと協働しようとしているログ

## TL;DR

issue書いてタスク書き出させて基本規約を読ませてコードを書かせたらいい感じ

## 今までの問題点

 - 大きい設計書を書いて大きいコードを書かせるとレビューコストも大きくなる
 - 設計書がざっくりしているとコードもざっくりしてしまってよろしくない
 - かといって作業を小さくしすぎるとAIの速度の恩恵を受けにくい
 - 設計書を読ませておいてチャットで後出しをすると小手先で何とかしようとしてきてコードの精度が下がる（体感）

 ## 試したこと

 1. まず最初にREADMEを書いて読ませてプロダクト全体の機能を把握させる
 1. 作業単位でissueを書く
 1. AIに対して「issueを読んでタスクを作ってtask.mdに記入して。疑問点があれば質問して。まだコードは書かないで」と指示する
 1. AIが作ったタスクを確認して過不足・連絡漏れをチェックする
 1. AIに基本規約を読ませる（ここでも「まだ書かないで」と指示する）
 1. 満を持してAIにコードを書かせる

「まだコードは書かないで」と指示しないと早とちりしたまま頑張ってコードを書いてくれるのでこの指示は大事です。

## 基本規約

基本規約にはセキュリティ規約（最小権限がどうとか）とかコーディング規約（必ずテストを書け、RuboCopに従え、各クラスは単一の責務に集中せよ）とかテスト方針（単体テストでDB接続は行わない、必要な場合にはテストハーネスを利用する）とかが書いてある。  
指定しなかったらminitestを書いてきたので「RSpecを使え」みたいな記述も追加した。RSpecにしてるのは[committee-rails](https://github.com/willnet/committee-rails)でドキュメント整合性チェックをやりたかったからです。  
あと意外だったのはマイグレーションファイルを修正し始めたところ。マイグレーションファイルを書き換えられるのは困るのでこれも基本規約に追加した。

基本規約こんな感じ: [basic-rule.md](https://github.com/perpouh/chatsystem/blob/spec/domain-first/docs/basic-rule.md)  
これもざっくりした箇条書きをAIに補完させている。

## 寸感

issueの単位で作業させられるのが良い。

コミットはできていないのでコミット周辺の規約は役に立っていない。この辺りは追々見ていくことにする。

基本規約が結構いい仕事をしており、設計書(issue)を書く手間が軽減した。  
まだビジネスロジックとかの複雑なところまで触ってないのでこれからどうなっていくかは未知数だけど、少なくとも以前よりはコードの質が上がったと思う。  

ひょっとしたらissueをテスト設計書的に書いてるのも効いているかもしれない？  
「○○ができること」だと最小権限ぶっちぎってバックドアじみたコードを書いてくるけど「××できないこと」はちゃんと効くのかも。

ちょっとまだ付きっきりで見てないといけないのであまり協働できている感じは無いけど、速度自体は上がったような気がしないでもない。AIがコード書いている時間も私がフリーになっていないのがネック。